<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Otaku Tab</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="dist/tailwind.css" />
  <!-- Minimal inline layout helpers that are not in Tailwind build yet -->
  <style>
    html,body{height:100%;overflow:hidden;background:#0f1629;color:#e0ebff;font-family:'Inter',system-ui,sans-serif;}
    main.otk-layout{display:grid;grid-template-columns:minmax(240px,320px) 1fr;gap:1.25rem;height:100%;padding:1rem;box-sizing:border-box;}
    @media (max-width:960px){main.otk-layout{grid-template-columns:1fr;}}
    .otk-favorites-panel{display:flex;flex-direction:column;min-height:0;}
    #favorites-container{flex:1;overflow:auto;padding-right:4px;}
    .content-view{display:none;}
    .content-view.active-view{display:block;}
    .otk-btn-subtle.active-view{background:linear-gradient(90deg,rgba(167,139,250,.15),rgba(96,165,250,.15));border-color:rgba(167,139,250,.55);color:#a78bfa;}
    /* Favorites swimlanes */
    .fav-swimlanes{display:grid;gap:.75rem;font-size:11px;}
    .fav-day-column{background:rgba(28,37,66,.55);border:1px solid rgba(109,40,217,.25);border-radius:14px;padding:.5rem .65rem;display:flex;flex-direction:column;gap:.5rem;}
    .fav-day-header{display:flex;align-items:center;gap:.5rem;font-size:.7rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:#bcd3ff;margin:0;}
    .fav-today-badge{background:#8b5cf6;color:#fff;font-size:.55rem;font-weight:600;padding:.15rem .4rem;border-radius:999px;letter-spacing:.05em;}
    .fav-day-content{display:flex;gap:.5rem;overflow-x:auto;padding-bottom:.25rem;}
    .fav-card{flex:none;width:110px;display:flex;flex-direction:column;gap:.35rem;font-weight:500;background:linear-gradient(145deg,rgba(31,41,72,.85),rgba(22,33,62,.65));border:1px solid rgba(109,40,217,.35);border-radius:12px;overflow:hidden;position:relative;}
    .fav-thumb-wrapper{position:relative;width:100%;aspect-ratio:2/3;overflow:hidden;}
    .fav-thumb-wrapper img{width:100%;height:100%;object-fit:cover;display:block;}
    .fav-remove{position:absolute;top:4px;right:4px;background:rgba(15,17,30,.7);border:1px solid rgba(167,139,250,.45);color:#c084fc;border-radius:6px;padding:2px;cursor:pointer;opacity:0;transition:.3s;}
    .fav-thumb-wrapper:hover .fav-remove{opacity:1;}
    .fav-meta{padding:.4rem .5rem .55rem;display:flex;flex-direction:column;gap:.25rem;font-size:.6rem;line-height:1.1;}
    .fav-title{margin:0;font-size:.6rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .fav-info{display:flex;justify-content:space-between;font-size:.55rem;opacity:.85;}
    .fav-empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.75rem;padding:1.25rem;text-align:center;background:rgba(31,41,72,.4);border:1px dashed rgba(109,40,217,.4);border-radius:14px;font-size:.7rem;}
    /* Schedule grid skeleton */
    .skeleton-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:1rem;}
    .skeleton{background:linear-gradient(110deg,#2e3b5e 8%,#3a4a72 18%,#2e3b5e 33%);background-size:200% 100%;animation:pulse 1.2s linear infinite;border-radius:14px;}
    .skeleton-item{height:230px;}
    .skeleton-tile{width:150px;height:240px;border-radius:16px;}
    @keyframes pulse{to{background-position:-200% 0;}}
    /* Anime detail modal primitives retained (rendered by JS) */
  .ad-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(15,23,42,.82);backdrop-filter:blur(14px);z-index:70;padding:2rem;}
  .ad-overlay.hidden{display:none!important;}
  .ad-modal{position:relative;width:clamp(340px,980px,92vw);max-height:92vh;overflow-y:auto;background:linear-gradient(145deg,rgba(23,31,52,.96),rgba(16,23,39,.94));border:1px solid rgba(139,92,246,.4);border-radius:30px;box-shadow:0 14px 50px -10px rgba(0,0,0,.75),0 0 0 1px rgba(139,92,246,.3);padding:0;}
  .ad-close{position:absolute;top:18px;right:18px;background:rgba(34,42,69,.85);border:2px solid rgba(167,139,250,.55);color:#c084fc;width:44px;height:44px;border-radius:50%;font-size:24px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(12px);transition:.3s;z-index:10;}
  .ad-close:hover{background:rgba(167,139,250,.25);transform:scale(1.07);}
  .ad-header{position:relative;}
  .ad-banner{height:220px;overflow:hidden;border-top-left-radius:30px;border-top-right-radius:30px;position:relative;background:linear-gradient(135deg,#1e2a47,#253557);}
  .ad-banner img{width:100%;height:100%;object-fit:cover;filter:brightness(.85) saturate(1.08);}
  .ad-banner-gradient{position:absolute;inset:0;background:linear-gradient(to bottom,rgba(20,28,45,.35),rgba(20,26,40,.8) 70%,rgba(20,26,40,.95));}
  .ad-hero{display:grid;grid-template-columns:180px 1fr;gap:1.75rem;padding:1.75rem 2rem 1.75rem;margin-top:-70px;align-items:flex-end;position:relative;}
  @media (max-width:860px){.ad-hero{grid-template-columns:140px 1fr;margin-top:-60px;gap:1.25rem;padding:1.25rem 1.5rem 1.5rem;}}
  @media (max-width:560px){.ad-hero{grid-template-columns:1fr;margin-top:-40px;text-align:center;}.ad-cover{margin:0 auto;}.ad-actions,.ad-stats,.ad-tags,.ad-sub{justify-content:center;}}
  .ad-cover{width:180px;aspect-ratio:2/3;border-radius:22px;overflow:hidden;box-shadow:0 10px 28px -8px rgba(0,0,0,.65),0 0 0 1px rgba(139,92,246,.35);position:relative;}
  .ad-cover img{width:100%;height:100%;object-fit:cover;display:block;}
  .ad-fav-btn{position:absolute;bottom:10px;right:10px;background:rgba(31,41,72,.8);border:2px solid rgba(139,92,246,.55);color:#c084fc;width:42px;height:42px;border-radius:14px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:600;transition:.35s;backdrop-filter:blur(8px);}
  .ad-fav-btn.is-favorited{background:linear-gradient(135deg,#c084fc,#ec4899);color:#fff;border-color:#fff;}
  .ad-fav-btn:hover{transform:translateY(-4px) scale(1.05);box-shadow:0 8px 20px -6px rgba(139,92,246,.55);}
  .ad-fav-btn:focus-visible{outline:3px solid #c084fc;outline-offset:3px;}
  .ad-hero-meta{display:flex;flex-direction:column;gap:.75rem;min-width:0;}
  .ad-title{margin:0;font-size:clamp(1.5rem,2.4vw,2.4rem);font-weight:700;letter-spacing:.75px;background:linear-gradient(90deg,#c084fc,#60a5fa,#22d3ee);-webkit-background-clip:text;background-clip:text;color:transparent;}
  .ad-badges{display:flex;flex-wrap:wrap;gap:.5rem;margin:.25rem 0 .35rem;}
  .ad-badge{display:inline-flex;align-items:center;font-size:.58rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;padding:.42rem .65rem;border:1px solid rgba(139,92,246,.45);border-radius:999px;background:rgba(30,41,72,.55);backdrop-filter:blur(6px);color:#e5e9f7;}
  .ad-sub{font-size:.7rem;letter-spacing:.05em;font-weight:500;color:#bcd3ff;opacity:.9;}
  .ad-tags{font-size:.55rem;letter-spacing:.15em;text-transform:uppercase;color:#8898b5;display:flex;flex-wrap:wrap;gap:.45rem;}
  .ad-stats{display:flex;flex-wrap:wrap;gap:.75rem;align-items:center;margin-top:.25rem;font-size:.75rem;font-weight:600;}
  .ad-score{color:#fcd34d;text-shadow:0 0 10px rgba(252,211,77,.45);font-size:1.15rem;display:flex;align-items:center;gap:.25rem;}
  .ad-airing{font-size:.65rem;color:#caa9ff;font-weight:600;letter-spacing:.08em;}
  .ad-actions{display:flex;gap:.8rem;margin-top:.5rem;align-items:center;}
  .ad-body{padding:0 2rem 2.25rem;}
  .ad-section-title{margin:0 0 .75rem;font-size:.85rem;font-weight:600;letter-spacing:.12em;text-transform:uppercase;color:#bcd3ff;}
  .ad-desc{font-size:.78rem;line-height:1.5;white-space:pre-line;color:#d2ddf5;background:rgba(31,41,72,.55);border:1px solid rgba(139,92,246,.25);padding:1rem 1.25rem;border-radius:18px;backdrop-filter:blur(4px);max-height:320px;overflow:auto;}
  .ad-desc::-webkit-scrollbar{width:6px;}
  .ad-desc::-webkit-scrollbar-thumb{background:linear-gradient(#8b5cf6,#ec4899);border-radius:3px;}
  @media (max-width:560px){.ad-body{padding:0 1.25rem 1.75rem;}.ad-cover{width:160px;}}
    .otk-search-wrapper{position:relative;}
    .otk-search-results{position:absolute;top:100%;left:0;right:0;background:#1e2a38;border:1px solid rgba(109,40,217,.4);border-radius:10px;padding:.35rem .25rem;max-height:300px;overflow:auto;z-index:10;}
    .otk-search-results li{list-style:none;}
    .otk-search-results a{display:flex;align-items:center;gap:.5rem;padding:.3rem .45rem;border-radius:8px;font-size:.6rem;color:#e0ebff;text-decoration:none;}
    .otk-search-results a:hover{background:rgba(139,92,246,.25);}
    .otk-search-results img{width:32px;height:48px;object-fit:cover;border-radius:6px;}
    .otk-error{color:#ef4444;font-size:.6rem;margin-top:.3rem;}
    /* Horizontal rows */
    .hp-row-wrapper{position:relative;overflow:hidden;}
    .hp-row{display:flex;gap:.85rem;overflow-x:auto;padding:.4rem 0 1rem 0;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;}
    .hp-row::-webkit-scrollbar{height:8px;}
    .hp-row::-webkit-scrollbar-thumb{background:linear-gradient(90deg,rgba(139,92,246,.8),rgba(255,0,127,.6));border-radius:4px;}
    .hp-card{width:150px;flex:none;scroll-snap-align:start;border:1px solid rgba(109,40,217,.35);border-radius:16px;overflow:hidden;background:linear-gradient(145deg,rgba(31,41,72,.85),rgba(22,33,62,.65));backdrop-filter:blur(6px);display:flex;flex-direction:column;position:relative;transition:transform .45s, box-shadow .45s, border-color .45s;}
    .hp-card:before{content:"";position:absolute;inset:0;opacity:0;background:radial-gradient(circle at 50% 30%,rgba(139,92,246,.35),transparent 70%);transition:opacity .5s;}
    .hp-card:hover{transform:translateY(-10px) scale(1.03);border-color:rgba(139,92,246,.6);box-shadow:0 10px 28px -6px rgba(139,92,246,.35),0 0 0 1px rgba(139,92,246,.4);}
    .hp-card:hover:before{opacity:1;}
    .hp-thumb-wrapper{position:relative;width:100%;aspect-ratio:2/3;overflow:hidden;}
    .hp-thumb-wrapper img{width:100%;height:100%;object-fit:cover;display:block;transform:scale(1.05);transition:transform 1s ease;filter:saturate(1.05) contrast(1.05);}
    .hp-card:hover .hp-thumb-wrapper img{transform:scale(1.16);}
    .hp-meta{padding:.6rem .65rem .75rem;display:flex;flex-direction:column;gap:.35rem;font-size:11px;line-height:1.15;font-weight:500;color:#e0ebff;text-shadow:0 0 3px rgba(0,0,0,.4);}
    .hp-score{font-size:10px;font-weight:600;color:#caa9ff;letter-spacing:.5px;}
  </style>
</head>
<body>
  <main class="otk-layout">
    <!-- Favorites weekly schedule panel -->
    <aside class="otk-favorites-panel" aria-labelledby="favorites-title">
      <header class="flex items-center justify-between gap-3 mb-4">
        <h1 class="otk-app-title text-xl font-semibold tracking-wide">Otaku Tab</h1>
      </header>
      <h2 id="favorites-title" class="otk-section-title text-[11px] uppercase tracking-[0.15em] mb-2">My Weekly Schedule</h2>
      <div id="favorites-container" class="min-h-0"></div>
    </aside>

    <!-- Main content panel -->
    <section class="otk-content-panel flex flex-col min-h-0">
      <!-- Top toolbar -->
      <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between mb-4">
        <div class="flex-1 w-full sm:max-w-md otk-search-wrapper">
          <label for="search-input" class="sr-only">Search anime</label>
          <input id="search-input" class="otk-input" type="text" placeholder="Search anime..." autocomplete="off" aria-autocomplete="list" aria-expanded="false" />
          <ul id="search-results" class="otk-search-results hidden" role="listbox" aria-label="Search results"></ul>
          <div id="search-error" class="otk-error hidden" role="alert"></div>
        </div>
        <div class="flex gap-2" role="tablist" aria-label="Primary views">
          <button id="view-airing" class="otk-btn-subtle active-view" data-view="airing" role="tab" aria-controls="airing-view" aria-selected="true">Currently Airing</button>
          <button id="view-browse" class="otk-btn-subtle" data-view="browse" role="tab" aria-controls="browse-view" aria-selected="false">Browse</button>
          <button id="discover-btn" class="otk-btn-subtle" aria-haspopup="dialog">Random</button>
        </div>
      </div>

      <!-- View: Airing -->
      <div id="airing-view" class="content-view active-view" role="tabpanel" aria-labelledby="view-airing">
        <div class="flex items-center justify-between gap-3 mb-3">
          <h2 id="today-title" class="otk-section-title">Today's Airing</h2>
          <div class="flex items-center gap-2">
            <label for="sort-select" class="sr-only">Sort schedule</label>
            <div class="relative">
              <select id="sort-select" class="otk-select text-xs px-2 py-1 w-auto min-w-0 pr-6" aria-label="Sort airing list">
                <option value="score_desc">Score ↓</option>
                <option value="score_asc">Score ↑</option>
                <option value="title_asc">Title A-Z</option>
                <option value="title_desc">Title Z-A</option>
                <option value="time_asc">Time ↑</option>
                <option value="time_desc">Time ↓</option>
                <option value="episodes_desc">Episodes ↓</option>
                <option value="episodes_asc">Episodes ↑</option>
              </select>
              <div class="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-cyber-300 text-[10px]">▼</div>
            </div>
          </div>
        </div>
        <div id="schedule-list" class="grid gap-3" role="list" aria-label="Today's airing anime"></div>
        <div id="schedule-error" class="otk-error hidden" role="alert"></div>
      </div>

      <!-- View: Browse -->
      <div id="browse-view" class="content-view" role="tabpanel" aria-labelledby="view-browse">
        <section aria-labelledby="trending-title" class="mb-6">
          <div class="flex items-center justify-between gap-3 mb-3">
            <h2 id="trending-title" class="otk-section-title">Trending Now</h2>
            <a href="https://anilist.co/search/anime/trending" target="_blank" rel="noopener" class="otk-link text-xs">View All →</a>
          </div>
          <div class="hp-row-wrapper">
            <div id="row-trending" class="hp-row" aria-label="Trending anime" role="list"></div>
          </div>
        </section>
        <section aria-labelledby="popular-title" class="mb-4">
          <div class="flex items-center justify-between gap-3 mb-3">
            <h2 id="popular-title" class="otk-section-title">Popular This Season</h2>
            <a href="https://anilist.co/search/anime/popular" target="_blank" rel="noopener" class="otk-link text-xs">View All →</a>
          </div>
          <div class="hp-row-wrapper">
            <div id="row-popular" class="hp-row" aria-label="Popular season anime" role="list"></div>
          </div>
        </section>
        <div id="discover-error" class="otk-error hidden" role="alert"></div>
      </div>
    </section>
  </main>

  <!-- Discover (legacy) modal kept for graceful fallback -->
  <div id="discover-modal" class="otk-modal hidden" role="dialog" aria-modal="true" aria-labelledby="discover-modal-title">
    <div class="otk-modal-content">
      <button id="modal-close" class="otk-modal-close" aria-label="Close dialog">&times;</button>
      <h2 id="discover-modal-title" class="otk-modal-title">Random Anime</h2>
      <div id="discover-loading" class="text-xs tracking-wide text-cyber-300 animate-pulse hidden">Loading...</div>
      <div id="discover-result" class="otk-discover-result" role="document"></div>
    </div>
  </div>

  <!-- Anime Detail Modal root (content rendered by JS) -->
  <div id="anime-detail-overlay" class="ad-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="anime-detail-title">
    <div class="ad-modal">
      <button class="ad-close" aria-label="Close anime details">&times;</button>
      <div id="anime-detail-content"></div>
    </div>
  </div>

  <script type="module" src="src/main.js"></script>
</body>
</html>
